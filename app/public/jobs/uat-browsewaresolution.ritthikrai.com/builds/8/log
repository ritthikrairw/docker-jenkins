Started by user [8mha:////4HgPuEf4mfvsilbbCV2Ea6TGQ5cb36qmFvZn+/QzjxrfAAAAlx+LCAAAAAAAAP9b85aBtbiIQTGjNKU4P08vOT+vOD8nVc83PyU1x6OyILUoJzMv2y+/JJUBAhiZGBgqihhk0NSjKDWzXb3RdlLBUSYGJk8GtpzUvPSSDB8G5tKinBIGIZ+sxLJE/ZzEvHT94JKizLx0a6BxUmjGOUNodHsLgAzWEgZu/dLi1CL9xJTczDwAj6GcLcAAAAA=[0madmin
Running as SYSTEM
Building in workspace /var/jenkins_home/workspace/uat-browsewaresolution.ritthikrai.com
The recommended git tool is: NONE
using credential SSH - Jenkins
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/uat-browsewaresolution.ritthikrai.com/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url git@github.com:ritthikrairw/browsewaresolution.git # timeout=10
Fetching upstream changes from git@github.com:ritthikrairw/browsewaresolution.git
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
using GIT_SSH to set credentials 
 > git fetch --tags --force --progress -- git@github.com:ritthikrairw/browsewaresolution.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse origin/v0.3.2^{commit} # timeout=10
 > git rev-parse v0.3.2^{commit} # timeout=10
Checking out Revision ab6ddf022b36dc3083ab15fc5dffcf50078069f5 (v0.3.2)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f ab6ddf022b36dc3083ab15fc5dffcf50078069f5 # timeout=10
Commit message: "update deploy script"
 > git rev-list --no-walk ab6ddf022b36dc3083ab15fc5dffcf50078069f5 # timeout=10
[uat-browsewaresolution.ritthikrai.com] $ /bin/sh -xe /tmp/jenkins16048664595251885538.sh
+ cd system
+ chmod u+x build.sh
+ ./build.sh
start remove old package...
remove old package success.
current workspace directory
/var/jenkins_home/workspace/uat-browsewaresolution.ritthikrai.com
start build package
SSH: Connecting from host [4fc61e7c6a5a]
SSH: Connecting with configuration [uat-browsewaresolution.ritthikrai.com] ...
SSH: Creating session: username [deployer], hostname [188.166.216.234], port [22]
SSH: Connecting session ...
SSH: Connected
SSH: Opening SFTP channel ...
SSH: SFTP channel open
SSH: Connecting SFTP channel ...
SSH: Connected
SSH: cd [/home/deployer]
SSH: OK
SSH: cd [/home/deployer]
SSH: OK
SSH: cd [deploy]
SSH: OK
SSH: put [deploy-build.tar.gz]
SSH: OK
SSH: Opening exec channel ...
SSH: EXEC: channel open
SSH: EXEC: STDOUT/STDERR from command [export  __USER_DIR=/home/deployer
export  __DIR_PATH=/home/ritthikrai/domains/uat-browsewaresolution.ritthikrai.com
export  __USER=ritthikrai
export  __GROUP=ritthikrai

cd $__USER_DIR/deploy
# sudo chmod u+x deploy.sh
# sudo ./deploy.sh

#--------------------------------------------------------------------------------------------
# Server site
#--------------------------------------------------------------------------------------------

# Set variables
USER_DIR=$__USER_DIR
DIR_PATH=$__DIR_PATH
PUBLIC_PATH=$DIR_PATH/public_html
REVISION_NAME=$(date +"%Y%m%d%H%M%S")
REVISION_PATH=$DIR_PATH/revisions/$REVISION_NAME
SHARED_PATH=$DIR_PATH/shared

# Check exist DIR
[ ! -d "$SHARED_PATH" ] && sudo mkdir $SHARED_PATH
[ ! -d "$DIR_PATH/revisions" ] && sudo mkdir $DIR_PATH/revisions

# Make revisions directory and remove files
sudo mkdir $REVISION_PATH
sudo cp $USER_DIR/deploy/deploy-build.tar.gz $REVISION_PATH
cd $REVISION_PATH
sudo tar -xzf deploy-build.tar.gz
sudo rm deploy-build.tar.gz

# Check exist files
FILE=$REVISION_PATH/.htaccess
if [ -f "$FILE" ]; then
    sudo rm -rf $FILE
fi

FILE=$REVISION_PATH/wp-config.php
if [ -f "$FILE" ]; then
    sudo rm -rf $FILE
fi

DIR=$REVISION_PATH/wp-content/uploads
if [ -d "$DIR" ]; then
    sudo rm -rf $DIR
fi

# Symlinks
sudo rm -rf $PUBLIC_PATH
sudo ln -s $REVISION_PATH $PUBLIC_PATH
sudo ln -s $SHARED_PATH/uploads $PUBLIC_PATH/wp-content
sudo ln -s $SHARED_PATH/.htaccess $PUBLIC_PATH/.htaccess
sudo ln -s $SHARED_PATH/wp-config.php $PUBLIC_PATH/wp-config.php

# Set chown and chmod
USER=$__USER
GROUP=$__GROUP

sudo chown -R $USER:$GROUP $REVISION_PATH/
sudo chown -R $USER:$GROUP $SHARED_PATH/
sudo chown -R $USER:$GROUP $DIR_PATH/revisions/
sudo chown -R $USER:$GROUP $PUBLIC_PATH/
sudo chown -R $USER:$GROUP $PUBLIC_PATH
sudo chmod 755 $REVISION_PATH/
sudo chmod 755 $SHARED_PATH/
sudo chmod 755 $DIR_PATH/revisions/
sudo chmod 755 $PUBLIC_PATH/
sudo chmod 444 $PUBLIC_PATH/.htaccess
sudo chmod 444 $PUBLIC_PATH/nginx.conf
sudo chmod 444 $PUBLIC_PATH/wp-config.php


# Unset variables and remove files
sudo rm -rf $DIR_PATH/deploy
unset DIR_PATH
unset PUBLIC_PATH
unset REVISION_NAME
unset REVISION_PATH
unset SHARED_PATH
unset FILE
unset DIR

# Restart services
sudo service php7.4-fpm restart
sudo service php8.0-fpm restart
sudo service nginx restart

unset __DIR_PATH
unset __USER
unset __GROUP] ...
SSH: EXEC: connected
chmod: cannot operate on dangling symlink '/home/ritthikrai/domains/uat-browsewaresolution.ritthikrai.com/public_html/.htaccess'
chmod: cannot access '/home/ritthikrai/domains/uat-browsewaresolution.ritthikrai.com/public_html/nginx.conf': No such file or directory
chmod: cannot operate on dangling symlink '/home/ritthikrai/domains/uat-browsewaresolution.ritthikrai.com/public_html/wp-config.php'
SSH: EXEC: completed after 2,203 ms
SSH: Disconnecting configuration [uat-browsewaresolution.ritthikrai.com] ...
SSH: Transferred 1 file(s)
Build step 'Send files or execute commands over SSH' changed build result to SUCCESS
Finished: SUCCESS
